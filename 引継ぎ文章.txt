================================================================================
GAS案件 自動見積もりシステム - Claude引継ぎ文章
================================================================================
作成日: 2025年12月17日
目的: 次回Claude起動時に、このプロジェクトの状態を素早く把握するため

================================================================================
【1】プロジェクト概要
================================================================================

■ システム名
GAS案件 自動見積もりシステム

■ 目的
「無料でシステム開発します」という集客用のお問い合わせフォーム。
AIが自動で工数を判定し、無料対応可能かどうかを自動返信する。

■ クライアント
合同会社リバイラル システム開発事業部

■ 開発者メール
tomokiai423@gmail.com

================================================================================
【2】システム構成
================================================================================

■ 使用技術
- Google Apps Script (GAS)
- Google Spreadsheet（データベース）
- Claude API（AI工数判定）
- Chatwork API（社内通知）
- HTML/CSS/JavaScript（フォーム・管理画面）

■ URL一覧
- お問い合わせフォーム:
  https://script.google.com/macros/s/AKfycbyx1WKEXs0e4sSjpNoOACqWRIeX9EWZDtJgumRGjx4q27hiaM90OxcDf0xCPJ4LU57p/exec

- 管理画面:
  https://script.google.com/macros/s/AKfycbyx1WKEXs0e4sSjpNoOACqWRIeX9EWZDtJgumRGjx4q27hiaM90OxcDf0xCPJ4LU57p/exec?page=admin

- スプレッドシート:
  https://docs.google.com/spreadsheets/d/1A0QgC425A1yQDoZyg8ieB7sNPsyksH7b1uXrJeAJZL0/edit

■ スプレッドシートID
1A0QgC425A1yQDoZyg8ieB7sNPsyksH7b1uXrJeAJZL0

================================================================================
【3】ファイル一覧
================================================================================

保存場所: C:\Users\music008\Documents\GAS見積もりシステム

■ GASコードファイル（Apps Scriptエディタにコピー済み）
- 01_スプレッドシート初期設定.gs  ... 初期設定用（実行済み）
- 02_メインコード_v6.gs           ... メインロジック（最新版）★
- 03_フォーム.html                ... お客様向けフォーム
- 04_Claude API連携.gs            ... Claude API呼び出し
- 05_Chatwork通知_v2.gs           ... Chatwork通知（最新版）★
- 06_管理画面_v3.html             ... 社内管理画面（最新版）★
- 07_設定シート追加.gs            ... 設定シート作成用
- 08_テスト管理画面.html          ... デバッグ用テストページ

■ ドキュメント
- ガイドライン.txt                ... 詳細な運用マニュアル
- LINE共有用.txt                  ... LINE送信用の簡易版
- 引継ぎ文章.txt                  ... このファイル

■ 元の設計書
- C:\Users\music008\Documents\要件定義書等\GAS案件の自動見積もりシステム.md

================================================================================
【4】主要機能と処理フロー
================================================================================

1. お客様がフォーム送信
2. NGフィルターチェック（スマホアプリ等は即NG）
3. 規模感チェック（データ量・利用人数で工数加算）
4. Claude APIで工数判定
5. 判定結果:
   - OK（360分以下）→ 無料対応可能
   - BORDERLINE（361〜480分）→ 要ヒアリング
   - NG（481分以上 or 技術制約）→ 対応不可
6. 自動処理:
   - スプレッドシートに記録
   - お客様にメール送信（4パターン）
   - Chatworkに通知（OK/BORDERLINEの場合）

================================================================================
【5】開発中に解決した主な問題
================================================================================

■ 問題1: 管理画面にデータが表示されない
原因: SpreadsheetApp.getActiveSpreadsheet()がWebアプリでnullを返す
解決: SpreadsheetApp.openById(SPREADSHEET_ID)を直接使用

■ 問題2: UrlFetchApp権限エラー
原因: OAuthスコープが不足
解決: appsscript.jsonに以下を追加
{
  "oauthScopes": [
    "https://www.googleapis.com/auth/spreadsheets",
    "https://www.googleapis.com/auth/script.external_request",
    "https://www.googleapis.com/auth/script.send_mail"
  ]
}

■ 問題3: Chatwork APIエラー「Parameter 'self_unread' is not boolean」
原因: JSONペイロード形式の問題
解決: payload形式を変更
変更前: payload: { body: message }
変更後: payload: 'body=' + encodeURIComponent(message)
        + Content-Type: 'application/x-www-form-urlencoded'

■ 問題4: 本番環境でChatwork通知が動かない
原因: コード変更後に再デプロイしていなかった
解決: 「新しいデプロイ」で新URLを発行

================================================================================
【6】スプレッドシートのシート構成
================================================================================

1. 問い合わせ一覧 ... フォーム送信データを記録
2. 設定           ... システム設定値（APIキー、しきい値等）
3. メールテンプレート ... 自動返信メールの件名・本文
4. NGフィルター設定 ... NG判定の条件（現在は未使用、コードに直書き）

================================================================================
【7】設定シートの項目
================================================================================

- CLAUDE_API_KEY         ... Claude APIキー
- 日程調整URL            ... Calendly等のURL
- Chatwork APIトークン   ... Chatwork通知用
- Chatwork ルームID      ... 通知先ルーム
- 無料対応しきい値（分） ... 360（6時間）
- 要ヒアリングしきい値（分） ... 480（8時間）
- テストモード           ... TRUE=メール送信しない / FALSE=本番

================================================================================
【8】現在の状態
================================================================================

■ 完了済み
- Phase 1: MVP（フォーム、スプレッドシート、NGフィルター、自動返信メール）
- Phase 2: AI連携（Claude API、4パターン応答）
- Phase 3: 運用機能（Chatwork通知、管理画面、日程調整URL）
- 追加機能: 規模感チェック（データ量・利用人数による工数加算）
- ドキュメント: ガイドライン、LINE共有用文章

■ システム状態
- 本番稼働可能
- テストモード: TRUE（メール送信しない状態）
- 本番開始時は設定シートでFALSEに変更が必要

================================================================================
【9】注意事項
================================================================================

- URLはデプロイするたびに変わる（新しいデプロイを選んだ場合）
- コード変更後は必ず「デプロイを管理」→「新しいデプロイ」が必要
- 初回アクセス時「Google hasn't verified this app」警告が出る
  → 「詳細」→「Go to ... (unsafe)」で進める
- Apps Scriptエディタでの★最新版ファイル名に注意

================================================================================
【10】次回作業時の確認事項
================================================================================

1. 最新のURLを確認（デプロイ画面で確認可能）
2. テストモードの状態を確認（TRUE/FALSE）
3. Chatwork通知の動作確認
4. スプレッドシートにデータが記録されているか確認

================================================================================
以上
================================================================================
